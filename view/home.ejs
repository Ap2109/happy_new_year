<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Táº¡o Lá»i ChÃºc NÄƒm Má»›i 2025</title>
    <link rel="stylesheet" href="assets/css/home.css">
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
    <meta property="og:title" content="Táº¡o Lá»i ChÃºc NÄƒm Má»›i 2025">
    <meta property="og:description" content="Táº¡o vÃ  gá»­i nhá»¯ng lá»i chÃºc nÄƒm má»›i Ã½ nghÄ©a Ä‘áº¿n ngÆ°á»i thÃ¢n yÃªu">
    <meta property="og:image" content="assets/image/bgr.jpg">
    <meta property="og:url" content="https://happy-new-year-for-you.vercel.app/">
</head>
<body>
    <div class="firework"></div>
    <div class="lantern" style="top: 20px; right: 20px;"></div>

    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
    </div>

    <div class="container">
        <div class="home-content" id="homeContent">
            <h1>ğŸŠ ChÃ o Má»«ng NÄƒm Má»›i 2025 ğŸŠ</h1>
            <div class="lunar-year">NÄƒm áº¤t Tá»µ</div>
            
            <p class="description">
                HÃ£y gá»­i nhá»¯ng lá»i chÃºc tá»‘t Ä‘áº¹p nháº¥t Ä‘áº¿n ngÆ°á»i thÃ¢n yÃªu cá»§a báº¡n trong nÄƒm má»›i nÃ y. 
                Táº¡o má»™t thiá»‡p chÃºc má»«ng nÄƒm má»›i Ä‘á»™c Ä‘Ã¡o vÃ  Ã½ nghÄ©a Ä‘á»ƒ gá»­i tá»›i nhá»¯ng ngÆ°á»i special trong cuá»™c Ä‘á»i báº¡n.
            </p>

            <button onclick="showWishForm()" class="cta-button">
                ğŸ‹ Táº¡o Lá»i ChÃºc Ngay ğŸ‹
            </button>
            <a href="/hny/0" class="cta-button">
                ğŸ‰ Xem Demo ğŸ‰
            </a>

            <p class="description">
                NÄƒm má»›i áº¤t Tá»µ 2025 Ä‘ang Ä‘áº¿n gáº§n! <br>
                HÃ£y lÃ  ngÆ°á»i Ä‘áº§u tiÃªn gá»­i nhá»¯ng lá»i chÃºc tá»‘t Ä‘áº¹p nháº¥t Ä‘áº¿n ngÆ°á»i thÃ¢n vÃ  báº¡n bÃ¨! â¤ï¸
            </p>
        </div>

        <div class="form-container" id="formContainer">
            <h1>ğŸŠ Táº¡o Lá»i ChÃºc NÄƒm Má»›i ğŸŠ</h1>
            <div class="lunar-year">NÄƒm áº¤t Tá»µ 2025</div>

            <form id="wishForm">
                <div class="form-group">
                    <label for="name">ğŸ‘‹ TÃªn ngÆ°á»i chÃºc:</label>
                    <input type="text" id="name" name="name" required placeholder="Nháº­p tÃªn hoáº·c bÃ­ danh cá»§a báº¡n">
                </div>

                <div class="form-group">
                    <label for="title">âœ¨ TiÃªu Ä‘á» lá»i chÃºc:</label>
                    <input type="text" id="title" name="title" required placeholder="Nháº­p tiÃªu Ä‘á» cho lá»i chÃºc">
                </div>

                <div class="form-group">
                    <label for="content">ğŸ‹ Ná»™i dung lá»i chÃºc:</label>
                    <textarea id="content" name="content" required placeholder="Nháº­p ná»™i dung lá»i chÃºc nÄƒm má»›i"></textarea>
                </div>

                <div class="form-group">
                    <label for="image">ğŸ–¼ï¸ HÃ¬nh áº£nh cá»§a ngÆ°á»i nháº­n:</label>
                    <input type="file" id="image" name="image" required accept="image/*" onchange="previewImage(event)">
                    <div class="image-preview" id="imagePreview">
                        <img id="imagePreviewImg" src="" alt="Preview">
                    </div>
                </div>

                <button type="submit" class="cta-button">ğŸ‰ Gá»­i Lá»i ChÃºc ğŸ‰</button>
            </form>
        </div>

        <div id="successMessage">
            <h2 style="color: #e74c3c;">ğŸ‰ ChÃºc má»«ng! Lá»i chÃºc cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c táº¡o thÃ nh cÃ´ng! ğŸ‰</h2>
            <p style="font-size: 18px; margin: 20px 0;">Link lá»i chÃºc cá»§a báº¡n lÃ :</p>
            <div id="wishLink" style="padding: 15px; background: #f1c40f; border-radius: 8px; margin: 10px 0; cursor: pointer;" onclick="copyToClipboard(this.textContent)"></div>
            <p style="font-size: 16px; color: #7f8c8d;">Nháº¥n vÃ o link trÃªn Ä‘á»ƒ copy vÃ  gá»­i cho ngÆ°á»i thÃ¢n yÃªu cá»§a báº¡n nhÃ©! â¤ï¸</p>
            <p style="color: #7f8c8d;">LÆ°u Ã½: Web sáº½ Ä‘áº¿m ngÆ°á»£c tá»›i nÄƒm má»›i, sau Ä‘Ã³ má»›i hiá»ƒn thá»‹ lá»i chÃºc cá»§a báº¡n.</p>
            <script>
            function copyToClipboard(text) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('ÄÃ£ copy link thÃ nh cÃ´ng!');
                }).catch(err => {
                    console.error('KhÃ´ng thá»ƒ copy: ', err);
                });
            }
            </script>
        </div>
    </div>

    <div class="donate-box">
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=00020101021138620010A00000072701320006970454011899MM24044M620822530208QRIBFTTA53037045802VN62190515MOMOW2W620822536304AABA" alt="MÃ£ QR á»¦ng há»™">
        <div class="donate-text">ğŸ’ á»¦ng há»™ tÃ´i má»™t ly cÃ  phÃª ğŸ’</div>
    </div>

<script>
    const api_key = "<%= api_key %>";
</script>
<script>
    let imageBase64 = null;

        function createFirework() {
            const firework = document.createElement('div');
            firework.className = 'firecracker';
            firework.style.left = Math.random() * window.innerWidth + 'px';
            firework.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
            document.querySelector('.firework').appendChild(firework);

            setTimeout(() => {
                firework.remove();
            }, 3000);
        }

        function showWishForm() {
            const homeContent = document.getElementById('homeContent');
            const formContainer = document.getElementById('formContainer');

            homeContent.classList.add('hide');

            setTimeout(() => {
                homeContent.style.display = 'none';
                formContainer.style.display = 'block';

                // Trigger reflow
                formContainer.offsetHeight;

                formContainer.classList.add('show');
            }, 500);
        }

        setInterval(createFirework, 300);

        function previewImage(event) {
            const preview = document.getElementById('imagePreview');
            const previewImg = document.getElementById('imagePreviewImg');
            const file = event.target.files[0];

            if (file) {
                // Create an image element for compression
                const img = new Image();
                const reader = new FileReader();

                reader.onload = function () {
                    if (reader.result) {
                        img.src = reader.result.toString();
                        img.onload = function () {
                            // Create canvas for compression
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');

                            if (!ctx) {
                                console.error('Could not get canvas context');
                                return;
                            }

                            // Calculate new dimensions (max width/height of 800px)
                            let width = img.width;
                            let height = img.height;
                            const maxSize = 600;

                            if (width > height && width > maxSize) {
                                height = Math.round((height * maxSize) / width);
                                width = maxSize;
                            } else if (height > maxSize) {
                                width = Math.round((width * maxSize) / height);
                                height = maxSize;
                            }

                            // Set canvas dimensions
                            canvas.width = width;
                            canvas.height = height;

                            // Draw and compress image
                            ctx.drawImage(img, 0, 0, width, height);

                            // Convert to base64 with reduced quality
                            const compressedBase64 = canvas.toDataURL('image/jpeg', 0.6);

                            // Update preview and store compressed base64
                            if (previewImg) {
                                previewImg.style.display = 'block';
                                previewImg.setAttribute('src', compressedBase64);
                                imageBase64 = compressedBase64;
                            }
                        }
                    }
                }
                reader.readAsDataURL(file);
            }
        }

        document.getElementById('wishForm')?.addEventListener('submit', async function (e) {
            e.preventDefault();

            const loadingEl = document.getElementById('loading');
            const formContainerEl = document.getElementById('formContainer');
            const successMessageEl = document.getElementById('successMessage');
            const wishLinkEl = document.getElementById('wishLink');
            const nameInput = document.getElementById('name');
            const titleInput = document.getElementById('title');
            const contentInput = document.getElementById('content');
            const imageInput = document.getElementById('image');

            if (!nameInput || !titleInput || !contentInput || !imageInput ||
                !loadingEl || !formContainerEl || !successMessageEl || !wishLinkEl) {
                alert('CÃ³ lá»—i xáº£y ra: KhÃ´ng tÃ¬m tháº¥y cÃ¡c trÆ°á»ng form');
                return;
            }

            // Validate input
            if (!nameInput.value || !titleInput.value || !contentInput.value || !imageInput.files[0]) {
                alert('Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin vÃ  chá»n hÃ¬nh áº£nh');
                return;
            }

            // Show loading spinner
            loadingEl.classList.add('show');

            try {
                const formData = new FormData();
                formData.append('name', nameInput.value);
                formData.append('title', titleInput.value);
                formData.append('content', contentInput.value);
                formData.append('image', imageInput.files[0]);

                const response = await fetch('/api/v1/saveData', {
                    method: 'POST',
                    headers: {
                        'x-api-key': api_key
                    },
                    body: formData
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Network response was not ok');
                }

                const result = await response.json();

                if (result.error === 0) {
                    formContainerEl.style.display = 'none';
                    successMessageEl.style.display = 'block';

                    wishLinkEl.innerHTML = `${window.location.origin}/${result.id}`;
                    wishLinkEl.href = `${window.location.origin}/${result.id}`;
                } else {
                    alert('CÃ³ lá»—i xáº£y ra: ' + result.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('CÃ³ lá»—i xáº£y ra khi gá»­i lá»i chÃºc: ' + error.message);
            } finally {
                loadingEl.classList.remove('show');
            }
        });
</script>
</body>
</html>
