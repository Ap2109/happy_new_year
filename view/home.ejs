<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Táº¡o Lá»i ChÃºc NÄƒm Má»›i 2025</title>
    <link rel="stylesheet" href="assets/css/home.css">
</head>
<body>
    <div class="firework"></div>
    <div class="lantern" style="top: 20px; left: 20px;"></div>
    <div class="lantern" style="top: 20px; right: 20px;"></div>

    <div class="container">
        <div class="home-content" id="homeContent">
            <h1>ğŸŠ ChÃ o Má»«ng NÄƒm Má»›i 2025 ğŸŠ</h1>
            <div class="lunar-year">NÄƒm áº¤t Tá»µ</div>
            
            <p class="description">
                HÃ£y gá»­i nhá»¯ng lá»i chÃºc tá»‘t Ä‘áº¹p nháº¥t Ä‘áº¿n ngÆ°á»i thÃ¢n yÃªu cá»§a báº¡n trong nÄƒm má»›i nÃ y. 
                Táº¡o má»™t thiá»‡p chÃºc má»«ng nÄƒm má»›i Ä‘á»™c Ä‘Ã¡o vÃ  Ã½ nghÄ©a Ä‘á»ƒ gá»­i tá»›i nhá»¯ng ngÆ°á»i special trong cuá»™c Ä‘á»i báº¡n.
            </p>

            <button onclick="showWishForm()" class="cta-button">
                ğŸ‹ Táº¡o Lá»i ChÃºc Ngay ğŸ‹
            </button>

            <p class="description">
                NÄƒm má»›i áº¤t Tá»µ 2025 Ä‘ang Ä‘áº¿n gáº§n! <br>
                HÃ£y lÃ  ngÆ°á»i Ä‘áº§u tiÃªn gá»­i nhá»¯ng lá»i chÃºc tá»‘t Ä‘áº¹p nháº¥t Ä‘áº¿n ngÆ°á»i thÃ¢n vÃ  báº¡n bÃ¨! â¤ï¸
            </p>
        </div>

        <div class="form-container" id="formContainer">
            <h1>ğŸŠ Táº¡o Lá»i ChÃºc NÄƒm Má»›i ğŸŠ</h1>
            <div class="lunar-year">NÄƒm áº¤t Tá»µ 2025</div>

            <form id="wishForm">
                <div class="form-group">
                    <label for="name">ğŸ‘‹ TÃªn ngÆ°á»i chÃºc:</label>
                    <input type="text" id="name" name="name" required placeholder="Nháº­p tÃªn ngÆ°á»i chÃºc">
                </div>

                <div class="form-group">
                    <label for="title">âœ¨ TiÃªu Ä‘á» lá»i chÃºc:</label>
                    <input type="text" id="title" name="title" required placeholder="Nháº­p tiÃªu Ä‘á» lá»i chÃºc">
                </div>

                <div class="form-group">
                    <label for="content">ğŸ‹ Ná»™i dung lá»i chÃºc:</label>
                    <textarea id="content" name="content" required placeholder="Nháº­p ná»™i dung lá»i chÃºc nÄƒm má»›i"></textarea>
                </div>

                <div class="form-group">
                    <label for="image">ğŸ–¼ï¸ HÃ¬nh áº£nh cá»§a ngÆ°á»i nháº­n:</label>
                    <input type="file" id="image" name="image" required accept="image/*" onchange="previewImage(event)">
                    <div class="image-preview" id="imagePreview">
                        <img id="imagePreviewImg" src="" alt="Preview">
                    </div>
                </div>

                <button type="submit" class="cta-button">ğŸ‰ Gá»­i Lá»i ChÃºc ğŸ‰</button>
            </form>
        </div>

        <div id="successMessage">
            <h2 style="color: #e74c3c;">ğŸ‰ ChÃºc má»«ng! Lá»i chÃºc cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c táº¡o thÃ nh cÃ´ng! ğŸ‰</h2>
            <p style="font-size: 18px; margin: 20px 0;">Link lá»i chÃºc cá»§a báº¡n lÃ :</p>
            <div id="wishLink" style="padding: 15px; background: #f1c40f; border-radius: 8px; margin: 10px 0;"></div>
            <p style="font-size: 16px; color: #7f8c8d;">HÃ£y copy link trÃªn vÃ  gá»­i cho ngÆ°á»i thÃ¢n yÃªu cá»§a báº¡n nhÃ©! â¤ï¸</p>
        </div>
    </div>

    <div class="donate-box">
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=00020101021138620010A00000072701320006970454011899MM24044M620822530208QRIBFTTA53037045802VN62190515MOMOW2W620822536304AABA" alt="MÃ£ QR á»¦ng há»™">
        <div class="donate-text">ğŸ’ á»¦ng há»™ tÃ´i má»™t ly cÃ  phÃª ğŸ’</div>
    </div>

    <script>
        let imageBase64 = null;

        function createFirework() {
            const firework = document.createElement('div');
            firework.className = 'firecracker';
            firework.style.left = Math.random() * window.innerWidth + 'px';
            firework.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
            document.querySelector('.firework').appendChild(firework);

            setTimeout(() => {
                firework.remove();
            }, 3000);
        }

        function showWishForm() {
            const homeContent = document.getElementById('homeContent');
            const formContainer = document.getElementById('formContainer');
            
            homeContent.classList.add('hide');
            
            setTimeout(() => {
                homeContent.style.display = 'none';
                formContainer.style.display = 'block';
                
                // Trigger reflow
                formContainer.offsetHeight;
                
                formContainer.classList.add('show');
            }, 500);
        }

        setInterval(createFirework, 300);

        function previewImage(event) {
            const preview = document.getElementById('imagePreview');
            const previewImg = document.getElementById('imagePreviewImg');
            const file = event.target.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function() {
                    previewImg.style.display = 'block';
                    previewImg.src = reader.result;
                    imageBase64 = reader.result;
                }
                reader.readAsDataURL(file);
            }
        }

        document.getElementById('wishForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const wishData = {
                name: document.getElementById('name').value,
                title: document.getElementById('title').value,
                content: document.getElementById('content').value,
                image: imageBase64
            };

            try {
                const response = await fetch('/api/v1/saveData', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': '<%= api_key %>'
                    },
                    body: JSON.stringify(wishData)
                });

                const result = await response.json();

                if (result.error === 0) {
                    document.getElementById('formContainer').style.display = 'none';
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('wishLink').textContent = `${window.location.origin}/${result.id}`;
                } else {
                    alert('CÃ³ lá»—i xáº£y ra: ' + result.message);
                }
            } catch (error) {
                alert('CÃ³ lá»—i xáº£y ra khi gá»­i lá»i chÃºc, LiÃªn há»‡ admin Ä‘á»ƒ Ä‘Æ°á»£c há»— trá»£');
            }
        });
    </script>
</body>
</html>
